{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://spec.continuum.local/atlas/pages.schema.json#1",
  "title": "PageRecord",
  "description": "Page crawl record for Atlas v1.0 - Owner: Cai Frazier",
  "type": "object",
  "required": [
    "url",
    "finalUrl",
    "normalizedUrl",
    "urlKey",
    "origin",
    "pathname",
    "statusCode",
    "fetchedAt",
    "rawHtmlHash",
    "title",
    "renderMode",
    "depth",
    "discoveredInMode"
  ],
  "additionalProperties": false,
  "properties": {
    "page_id": { 
      "type": "string",
      "description": "UUID v7 (time-ordered, globally unique) - Atlas v1.0 Enhancement"
    },
    "url": { "type": "string" },
    "finalUrl": { "type": "string" },
    "normalizedUrl": { "type": "string" },
    "urlKey": { "type": "string" },
    "origin": { "type": "string" },
    "pathname": { "type": "string" },
    "statusCode": { "type": "integer" },
    "fetchedAt": { "type": "string", "format": "date-time" },
    "rawHtmlHash": { "type": "string" },
    "domHash": { "type": "string" },
    "contentHash": { 
      "type": "string",
      "description": "SHA-256 of normalized text content - Atlas v1.0 Enhancement"
    },
    "previous_page_id": { 
      "type": "string",
      "description": "page_id from previous crawl for re-crawl diffing - Atlas v1.0 Enhancement"
    },
    "content_changed": { 
      "type": "boolean",
      "description": "Did content change since last crawl? - Atlas v1.0 Enhancement"
    },
    "dom_changed": { 
      "type": "boolean",
      "description": "Did DOM change since last crawl? - Atlas v1.0 Enhancement"
    },
    "timing": {
      "type": "object",
      "description": "Detailed timing breakdown for fetch and render phases - Atlas v1.0 Enhancement Phase 3",
      "properties": {
        "fetch_started_at": { "type": "string", "format": "date-time" },
        "fetch_completed_at": { "type": "string", "format": "date-time" },
        "render_started_at": { "type": "string", "format": "date-time" },
        "render_completed_at": { "type": "string", "format": "date-time" }
      }
    },
    "title": { "type": "string" },
    "metaDescription": { "type": ["string", "null"] },
      "section": { "type": "string" },
      "contentType": { "type": ["string", "null"] },
      "redirectChain": {
        "type": ["array", "null"],
        "items": { "type": "string" }
      },
      "canonicalHref": { "type": ["string", "null"] },
      "canonicalResolved": { "type": ["string", "null"] },
      "noindexSurface": {
        "type": ["string", "null"],
        "enum": ["meta", "header", "both", null]
      },
      "fetchMs": { "type": "integer" },
      "internalLinksCount": { "type": "integer" },
      "externalLinksCount": { "type": "integer" },
      "mediaAssetsCount": { "type": "integer" },
      "mediaAssetsTruncated": { "type": "boolean" },
      "hreflangLinks": {
        "type": ["array", "null"],
        "items": {
          "type": "object",
          "properties": {
            "url": { "type": "string" },
            "lang": { "type": "string" }
          },
          "required": ["url", "lang"],
          "additionalProperties": false
        }
      },
      "discoveredFrom": { "type": ["string", "null"] },
      "basicFlags": {
        "type": "object",
        "properties": {
          "hasTitle": { "type": "boolean" },
          "hasMetaDescription": { "type": "boolean" },
          "hasH1": { "type": "boolean" },
          "hasCanonical": { "type": "boolean" }
        },
        "required": ["hasTitle", "hasMetaDescription", "hasH1", "hasCanonical"],
        "additionalProperties": false
      },
    "h1": { "type": "string" },
    "headings": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["level", "text"],
        "properties": {
          "level": { "type": "integer", "minimum": 1, "maximum": 6 },
          "text": { "type": "string" }
        }
      }
    },
    "canonical": { "type": "string" },
    "robotsMeta": { "type": "string" },
    "robotsHeader": { "type": "string" },
    "textSample": { "type": "string" },
    "renderMode": {
      "type": "string",
      "enum": ["raw", "prerender", "full"],
      "description": "Render mode used for this page (Atlas v1.0 enum)"
    },
    "renderMs": { "type": "integer" },
    "wait_condition": {
      "type": ["string", "null"],
      "enum": ["domcontentloaded", "networkidle0", "networkidle2", "load", null],
      "description": "Render wait condition used by the renderer (Atlas v1.0 Phase 3B)"
    },
    "timings": {
      "type": ["object", "null"],
      "description": "High-resolution navigation and paint timing marks (Atlas v1.0 Phase 3B)",
      "properties": {
        "nav_start": { "type": "number" },
        "dom_content_loaded": { "type": ["number", "null"] },
        "load_event_end": { "type": ["number", "null"] },
        "network_idle_reached": { "type": ["number", "null"] },
        "first_paint": { "type": ["number", "null"] },
        "first_contentful_paint": { "type": ["number", "null"] }
      },
      "additionalProperties": false
    },
    "navEndReason": {
      "type": "string",
      "enum": ["fetch", "load", "networkidle", "timeout", "error"],
      "description": "Why page navigation ended (Atlas v1.0 enum)"
    },
    "depth": { "type": "integer", "minimum": 0 },
    "discoveredInMode": {
      "type": "string",
      "enum": ["raw", "prerender", "full"],
      "description": "Render mode when this URL was discovered (Atlas v1.0 enum)"
    },
    "error": { "type": "string" },
    "faviconUrl": { "type": ["string", "null"] },
    "techStack": {
      "type": ["array", "null"],
      "items": { "type": "string" }
    },
    "technologies": {
      "type": ["array", "null"],
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "version": { "type": ["string", "null"] },
          "categories": {
            "type": ["array", "null"],
            "items": { "type": "string" }
          }
        },
        "required": ["name"],
        "additionalProperties": false
      }
    },
    "openGraph": {
      "type": ["object", "null"],
      "properties": {
        "ogTitle": { "type": ["string", "null"] },
        "ogDescription": { "type": ["string", "null"] },
        "ogImage": { "type": ["string", "null"] },
        "ogUrl": { "type": ["string", "null"] },
        "ogType": { "type": ["string", "null"] },
        "ogSiteName": { "type": ["string", "null"] },
        "ogLocale": { "type": ["string", "null"] }
      },
      "additionalProperties": true
    },
    "twitterCard": {
      "type": ["object", "null"],
      "properties": {
        "twitterCard": { "type": ["string", "null"] },
        "twitterSite": { "type": ["string", "null"] },
        "twitterCreator": { "type": ["string", "null"] },
        "twitterTitle": { "type": ["string", "null"] },
        "twitterDescription": { "type": ["string", "null"] },
        "twitterImage": { "type": ["string", "null"] }
      },
      "additionalProperties": true
    },
    "structuredData": {
      "type": ["array", "null"],
      "items": {
        "type": "object",
        "additionalProperties": true
      }
    },
    "viewportMeta": {
      "type": ["object", "null"],
      "properties": {
        "width": { "type": ["string", "number", "null"] },
        "initialScale": { "type": ["string", "number", "null"] },
        "minimumScale": { "type": ["string", "number", "null"] },
        "maximumScale": { "type": ["string", "number", "null"] },
        "userScalable": { "type": ["string", "boolean", "null"] }
      },
      "additionalProperties": true
    },
    "enhancedSEO": {
      "type": ["object", "null"],
      "additionalProperties": true
    },
    "seo": {
      "type": ["object", "null"],
      "additionalProperties": true
    },
    "performance": {
      "type": ["object", "null"],
      "additionalProperties": true
    },
    "network": {
      "type": ["object", "null"],
      "additionalProperties": true
    },
    "resourceCounts": {
      "type": ["object", "null"],
      "additionalProperties": true
    },
    "compression": {
      "type": ["object", "null"],
      "additionalProperties": true
    },
    "encoding": {
      "type": ["object", "null"],
      "description": "HTML document encoding detection details",
      "properties": {
        "encoding": { "type": "string" },
        "source": {
          "type": "string",
          "enum": ["meta", "header", "detected"]
        }
      },
      "required": ["encoding", "source"],
      "additionalProperties": false
    },
    "subresourceIntegrity": {
      "type": ["object", "null"],
      "additionalProperties": true
    },
    "mixedContentIssues": {
      "type": ["array", "null"],
      "items": {
        "type": "object",
        "required": ["assetUrl", "type"],
        "properties": {
          "assetUrl": { "type": "string" },
          "type": {
            "type": "string",
            "enum": ["script", "stylesheet", "image", "video", "audio", "iframe", "other"]
          }
        },
        "additionalProperties": false
      }
    },
    "media": {
      "type": ["object", "null"],
      "properties": {
        "screenshots": {
          "type": ["object", "null"],
          "properties": {
            "desktop": { "type": ["string", "null"] },
            "mobile": { "type": ["string", "null"] }
          },
          "additionalProperties": false
        },
        "favicon": { "type": ["string", "null"] }
      },
      "additionalProperties": false
    },
    "response_headers": {
      "type": ["object", "null"],
      "description": "HTTP response headers captured during fetch - Atlas v1.0 Enhancement Phase 5",
      "properties": {
        "content_type": { "type": "string" },
        "content_length": { "type": "integer" },
        "content_encoding": { "type": "string" },
        "cache_control": { "type": "string" },
        "expires": { "type": "string" },
        "etag": { "type": "string" },
        "last_modified": { "type": "string" },
        "age": { "type": "integer" },
        "server": { "type": "string" },
        "x_powered_by": { "type": "string" },
        "via": { "type": "string" },
        "x_cache": { "type": "string" },
        "cf_cache_status": { "type": "string" },
        "x_amz_cf_id": { "type": "string" },
        "x_cdn_provider": { "type": "string" },
        "strict_transport_security": { "type": "string" },
        "content_security_policy": { "type": "string" },
        "x_frame_options": { "type": "string" },
        "x_content_type_options": { "type": "string" },
        "referrer_policy": { "type": "string" },
        "permissions_policy": { "type": "string" },
        "vary": { "type": "string" },
        "pragma": { "type": "string" },
        "date": { "type": "string" },
        "connection": { "type": "string" },
        "transfer_encoding": { "type": "string" }
      },
      "additionalProperties": false
    },
    "cdn_indicators": {
      "type": ["object", "null"],
      "description": "CDN provider detection metadata - Atlas v1.0 Enhancement Phase 5",
      "properties": {
        "detected": { "type": "boolean" },
        "provider": { 
          "type": "string",
          "enum": ["cloudflare", "cloudfront", "fastly", "akamai", "unknown"]
        },
        "confidence": {
          "type": "string",
          "enum": ["high", "medium", "low"]
        },
        "signals": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "required": ["detected", "confidence", "signals"],
      "additionalProperties": false
    },
    "compression_details": {
      "type": ["object", "null"],
      "description": "Compression algorithm and metrics - Atlas v1.0 Enhancement Phase 5",
      "properties": {
        "algorithm": {
          "type": "string",
          "enum": ["gzip", "br", "deflate", "none"]
        },
        "compressed_size": { "type": "integer" },
        "supports_brotli": { "type": "boolean" }
      },
      "additionalProperties": false
    },
    "screenshotFile": { "type": ["string", "null"] },
    "viewportFile": { "type": ["string", "null"] },
    "challengePageCaptured": { "type": ["boolean", "null"] }
  }
}
